{% extends 'layout.html' %}

{% block content %}
  <div class="timeline">
    <form id="join-form" action="/auth/join" method="post" onsubmit="handleSubmit(event)">
      <div class="input-group">
        <label for="join-email">이메일</label>
        <input id="join-email" type="email" name="email">
      </div>
      <div class="input-group">
        <label for="join-nick">닉네임</label>
        <input id="join-nick" type="text" name="nick">
      </div>
      <div class="input-group">
        <label for="join-password">비밀번호</label>
        <input id="join-password" type="password" name="password">
      </div>
      <button id="join-btn" type="submit" class="btn">회원가입</button>
    </form>
  </div>
{% endblock %}

{% block script %}
  <script>
    // 페이지 로드 시 쿼리 파라미터 확인
    window.onload = () => {
      if (new URL(location.href).searchParams.get('error')) {
        alert('이미 존재하는 이메일입니다.');
      }
    };

    // 페이지 로드 시 쿼리 파라미터 확인
    // window.onload = () => {
    //   const urlParams = new URLSearchParams(window.location.search);
    //   const error = urlParams.get('error');
    //   if (error === 'true') {
    //     alert('로그인 실패! 사용자명 또는 비밀번호가 잘못되었습니다.');
    //   }
    // };

    // 폼 제출 처리
    // async function handleSubmit(event) {
    //   event.preventDefault();  // 기본 폼 제출을 막음

    //   const formData = new FormData(event.target);
    //   const formObject = {};
    //   formData.forEach((value, key) => {
    //     formObject[key] = value;
    //   });

    //   try {
    //     const response = await fetch('/auth/join', {
    //       method: 'POST',
    //       headers: {
    //         'Content-Type': 'application/json',
    //       },
    //       body: JSON.stringify(formObject),
    //     });

    //     if (!response.ok) {
    //       if (response.status === 401) {
    //         alert('로그인 실패! 사용자명 또는 비밀번호가 잘못되었습니다.');
    //         window.location.href = '/';  // 실패 시 루트 페이지로 리디렉션
    //       } else if (response.status === 409) { // 예: 이메일 중복 오류
    //         alert('이미 존재하는 이메일입니다.');
    //       } else {
    //         alert('알 수 없는 오류가 발생했습니다.');
    //       }
    //     } else {
    //       // 로그인 성공 시 리디렉션 처리
    //       window.location.href = '/';
    //     }
    //   } catch (error) {
    //     console.error('로그인 요청 처리 중 오류 발생:', error);
    //     alert('서버와의 연결에 실패했습니다. 나중에 다시 시도해 주세요.');
    //   }
    // }
  </script>
{% endblock %}
